---
title: Environment Variables
description: Configure environment variables for Opentribe applications
---

import { Callout } from "fumadocs-ui/components/callout";
import { Tabs, Tab } from "fumadocs-ui/components/tabs";

# Environment Variables

Opentribe uses environment variables to configure various services and integrations. Each application in the monorepo has its own `.env.local` file.

<Callout type="warning">
  Never commit `.env.local` files to version control. Use `.env.example` as templates.
</Callout>

## Configuration by Application

<Tabs>

<Tab value="web" label="apps/web">

### Web Application Environment Variables

```bash
# apps/web/.env.local

# Database (PostgreSQL)
DATABASE_URL="postgresql://username@localhost:5432/opentribe"

# Authentication
BETTER_AUTH_SECRET="your-random-32-character-secret-here"
BETTER_AUTH_URL="http://localhost:3002"

# API Configuration
NEXT_PUBLIC_API_URL="http://localhost:3002"
NEXT_PUBLIC_WEB_URL="http://localhost:3000"

# OAuth Providers (Optional)
GOOGLE_CLIENT_ID="your-google-client-id"
GOOGLE_CLIENT_SECRET="your-google-client-secret"
GITHUB_CLIENT_ID="your-github-client-id"
GITHUB_CLIENT_SECRET="your-github-client-secret"

# Analytics (Optional)
NEXT_PUBLIC_GA_ID="G-XXXXXXXXXX"
NEXT_PUBLIC_MIXPANEL_TOKEN="your-mixpanel-token"
```

</Tab>

<Tab value="dashboard" label="apps/dashboard">

### Dashboard Environment Variables

```bash
# apps/dashboard/.env.local

# Database (PostgreSQL)
DATABASE_URL="postgresql://username@localhost:5432/opentribe"

# Authentication (must match other apps)
BETTER_AUTH_SECRET="same-secret-as-web-app"
BETTER_AUTH_URL="http://localhost:3002"

# API Configuration
NEXT_PUBLIC_API_URL="http://localhost:3002"
NEXT_PUBLIC_DASHBOARD_URL="http://localhost:3001"

# Feature Flags (Optional)
NEXT_PUBLIC_ENABLE_ANALYTICS="true"
NEXT_PUBLIC_ENABLE_NOTIFICATIONS="true"
```

</Tab>

<Tab value="api" label="apps/api">

### API Server Environment Variables

```bash
# apps/api/.env.local

# Database (PostgreSQL)
DATABASE_URL="postgresql://username@localhost:5432/opentribe"

# Authentication (must match other apps)
BETTER_AUTH_SECRET="same-secret-as-web-app"
BETTER_AUTH_URL="http://localhost:3002"

# Blockchain Integration
SUBSCAN_API_KEY="your-subscan-api-key"  # For payment verification
SUBSCAN_API_URL="https://polkadot.api.subscan.io"

# Email Service (Resend)
RESEND_API_KEY="re_xxxxxxxxxx"
EMAIL_FROM="noreply@opentribe.io"
EMAIL_REPLY_TO="support@opentribe.io"

# CORS Configuration
CORS_ORIGINS="http://localhost:3000,http://localhost:3001"

# Rate Limiting
RATE_LIMIT_WINDOW="60000"  # 1 minute in ms
RATE_LIMIT_MAX="100"        # Max requests per window

# Webhook Secret (Optional)
WEBHOOK_SECRET="your-webhook-secret"

# File Storage (Optional)
UPLOAD_DIR="./uploads"
MAX_FILE_SIZE="10485760"  # 10MB in bytes
```

</Tab>

<Tab value="docs" label="apps/docs">

### Documentation Environment Variables

```bash
# apps/docs/.env.local

# Documentation specific (minimal configuration)
NEXT_PUBLIC_DOCS_URL="http://localhost:3004"
NEXT_PUBLIC_API_URL="http://localhost:3002"

# Search Integration (Optional)
ALGOLIA_APP_ID="your-algolia-app-id"
ALGOLIA_API_KEY="your-algolia-api-key"
ALGOLIA_INDEX_NAME="opentribe-docs"
```

</Tab>

</Tabs>

## Core Environment Variables

### Database Configuration

All applications need database access:

```bash
DATABASE_URL="postgresql://[user]:[password]@[host]:[port]/[database]"
```

**Format breakdown:**
- `user`: PostgreSQL username
- `password`: PostgreSQL password (optional for local)
- `host`: Database host (localhost for development)
- `port`: PostgreSQL port (default 5432)
- `database`: Database name (opentribe)

**Examples:**
```bash
# Local development (no password)
DATABASE_URL="postgresql://postgres@localhost:5432/opentribe"

# Local development (with password)
DATABASE_URL="postgresql://postgres:mypassword@localhost:5432/opentribe"

# Production (Neon)
DATABASE_URL="postgresql://user:pass@ep-xxx.us-east-2.aws.neon.tech/opentribe?sslmode=require"
```

### Authentication Configuration

<Callout type="error">
  **Critical**: All apps MUST use the same `BETTER_AUTH_SECRET` for session sharing to work!
</Callout>

```bash
# Generate a secure secret (32+ characters)
openssl rand -base64 32

# Use the same secret in all apps
BETTER_AUTH_SECRET="your-generated-secret-here"
BETTER_AUTH_URL="http://localhost:3002"  # Points to API server
```

### OAuth Provider Setup

#### Google OAuth

1. Go to [Google Cloud Console](https://console.cloud.google.com)
2. Create a new project or select existing
3. Enable Google+ API
4. Create OAuth 2.0 credentials
5. Add redirect URIs:
   - `http://localhost:3002/api/auth/callback/google` (development)
   - `https://api.opentribe.io/api/auth/callback/google` (production)

```bash
GOOGLE_CLIENT_ID="xxx.apps.googleusercontent.com"
GOOGLE_CLIENT_SECRET="GOCSPX-xxx"
```

#### GitHub OAuth

1. Go to GitHub Settings → Developer settings → OAuth Apps
2. Create new OAuth App
3. Set Authorization callback URL:
   - `http://localhost:3002/api/auth/callback/github` (development)
   - `https://api.opentribe.io/api/auth/callback/github` (production)

```bash
GITHUB_CLIENT_ID="Iv1.xxx"
GITHUB_CLIENT_SECRET="xxx"
```

### Blockchain Integration

For payment verification via Subscan:

```bash
# Get API key from https://pro.subscan.io/
SUBSCAN_API_KEY="your-api-key"
SUBSCAN_API_URL="https://polkadot.api.subscan.io"

# Network configuration
POLKADOT_NETWORK="polkadot"  # or "kusama", "westend" for testing
```

### Email Configuration

Using Resend for transactional emails:

```bash
# Get API key from https://resend.com
RESEND_API_KEY="re_xxxxxxxxxx"
EMAIL_FROM="Opentribe <noreply@opentribe.io>"
EMAIL_REPLY_TO="support@opentribe.io"

# Email settings
EMAIL_ENABLED="true"
EMAIL_PREVIEW="false"  # Set to true to preview emails in development
```

## Production Environment Variables

### Additional Production Variables

```bash
# apps/web/.env.production
NODE_ENV="production"
NEXT_PUBLIC_API_URL="https://api.opentribe.io"
NEXT_PUBLIC_WEB_URL="https://opentribe.io"

# apps/dashboard/.env.production
NEXT_PUBLIC_API_URL="https://api.opentribe.io"
NEXT_PUBLIC_DASHBOARD_URL="https://admin.opentribe.io"

# apps/api/.env.production
CORS_ORIGINS="https://opentribe.io,https://admin.opentribe.io"
RATE_LIMIT_MAX="60"  # Stricter in production

# Security headers
SECURE_COOKIES="true"
CSRF_PROTECTION="true"
```

### Vercel Environment Variables

When deploying to Vercel:

1. Go to Project Settings → Environment Variables
2. Add each variable for the appropriate environment
3. Use different values for Preview and Production

**Important Vercel variables:**
```bash
# Automatically set by Vercel
VERCEL_URL          # The deployment URL
VERCEL_ENV          # "production", "preview", or "development"
NEXT_PUBLIC_VERCEL_URL  # Public deployment URL
```

## Environment Variable Security

### Best Practices

1. **Never commit secrets**: Use `.gitignore` for all `.env*` files
2. **Use strong secrets**: Generate with `openssl rand -base64 32`
3. **Rotate regularly**: Change production secrets periodically
4. **Limit access**: Use environment-specific values
5. **Validate variables**: Check required vars at startup

### Secret Management

For production, consider using:
- **Vercel Secrets**: Built-in secret management
- **AWS Secrets Manager**: For AWS deployments
- **HashiCorp Vault**: Enterprise secret management
- **dotenv-vault**: Encrypted environment sync

### Required vs Optional

**Required for all apps:**
- `DATABASE_URL`
- `BETTER_AUTH_SECRET`
- `BETTER_AUTH_URL`

**Required for API:**
- `RESEND_API_KEY` (if email enabled)
- `SUBSCAN_API_KEY` (for payment verification)

**Optional enhancements:**
- OAuth providers (Google, GitHub)
- Analytics (GA, Mixpanel)
- Search (Algolia)

## Troubleshooting

### Common Issues

#### "Missing environment variable" error

```bash
# Check if variable is set
echo $DATABASE_URL

# Source the env file (development only)
source .env.local
```

#### Session not working across apps

Ensure all apps use:
- Same `BETTER_AUTH_SECRET`
- Same `BETTER_AUTH_URL`
- Correct `DATABASE_URL`

#### OAuth redirect mismatch

Check that redirect URIs match exactly:
- No trailing slashes
- Correct protocol (http/https)
- Correct port numbers

#### Payment verification failing

Verify Subscan API:
- API key is valid
- Correct network selected
- API endpoint accessible

## Development Tips

### Using .env.example

Create `.env.example` files as templates:

```bash
# .env.example
DATABASE_URL="postgresql://username@localhost:5432/opentribe"
BETTER_AUTH_SECRET="generate-me"
# Add other required variables with placeholder values
```

### Loading Order

Environment variables are loaded in this order:
1. `.env` (shared)
2. `.env.local` (local overrides, gitignored)
3. `.env.[NODE_ENV]` (environment-specific)
4. `.env.[NODE_ENV].local` (local environment overrides)

### Validation

Use zod for runtime validation:

```typescript
import { z } from 'zod'

const envSchema = z.object({
  DATABASE_URL: z.string().url(),
  BETTER_AUTH_SECRET: z.string().min(32),
  // ... other variables
})

export const env = envSchema.parse(process.env)
```

## Next Steps

- [Set up authentication](/docs/setup/authentication)
- [Configure database](/docs/setup/database)
- [Deploy to production](/docs/deployment)